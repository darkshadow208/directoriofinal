<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Guruji - Online Learning & Educational Courses </title>
	<link rel="icon" href="assets/images/favicon/icon.png">
	<link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="assets/css/all.min.css">
	<link rel="stylesheet" href="assets/css/slick.css">
	<link rel="stylesheet" href="assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/css/intlTelInput.css">
	<link rel="stylesheet" href="assets/css/style.css">
	<link rel="stylesheet" href="assets/css/media-query.css">
	<style>
	
</style>
</head>
<body>
	<div class="site-content">
		<!-- Preloader start -->
		<div class="loader-mask">
			<div class="loader">
			</div>
		</div>
		<!-- Preloader end -->
		<!-- Header start -->
		<header id="top-header">
			<div class="container">
				<div class="top-header-full">
					<div class="back-btn">
						<a href="javascript:history.go(-1)">
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<mask id="mask0_330_7385" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
									<rect width="24" height="24" fill="black"/>
								</mask>
								<g mask="url(#mask0_330_7385)">
									<path d="M15 18L9 12L15 6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
								</g>
							</svg>
						</a>
					</div>
					<div class="header-title">
						<p>Editar perfil</p>
					</div>
				</div>
			</div>
			<div class="navbar-boder"></div>
		</header>
		<!-- Header end -->
		<!-- Profile edit screen start -->
		<section id="profile-edit">
			<div class="container">
				<h1 class="d-none">Profile</h1>
				<h2 class="d-none">Hidden</h2>
				<div class="profile-edit-wrap mt-32">
					<div class="profile-edit-img">
						<img  style="width: 171px" id="profileImage" src="" alt="profile-img">
						<div class="image-input">
							<input style="width: 171px" class="img-fluid" type="file" accept="image/*" id="imageInput">
							<label for="imageInput" class="image-button">
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="mask0_202_7638" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
										<rect width="24" height="24" fill="white"/>
									</mask>
									<g mask="url(#mask0_202_7638)">
										<path d="M5 7H6C6.53043 7 7.03914 6.78929 7.41421 6.41421C7.78929 6.03914 8 5.53043 8 5C8 4.73478 8.10536 4.48043 8.29289 4.29289C8.48043 4.10536 8.73478 4 9 4H15C15.2652 4 15.5196 4.10536 15.7071 4.29289C15.8946 4.48043 16 4.73478 16 5C16 5.53043 16.2107 6.03914 16.5858 6.41421C16.9609 6.78929 17.4696 7 18 7H19C19.5304 7 20.0391 7.21071 20.4142 7.58579C20.7893 7.96086 21 8.46957 21 9V18C21 18.5304 20.7893 19.0391 20.4142 19.4142C20.0391 19.7893 19.5304 20 19 20H5C4.46957 20 3.96086 19.7893 3.58579 19.4142C3.21071 19.0391 3 18.5304 3 18V9C3 8.46957 3.21071 7.96086 3.58579 7.58579C3.96086 7.21071 4.46957 7 5 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
										<path d="M12 16C13.6569 16 15 14.6569 15 13C15 11.3431 13.6569 10 12 10C10.3431 10 9 11.3431 9 13C9 14.6569 10.3431 16 12 16Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
									</g>
								</svg>
							</label>
						</div>
					</div>
					<div class="profile-edit-bottom">
						<div class="sign-up-login-form mt-32">
							<form id="profileForm">
								<div class="form-details-sign-in margin-top">
									<span>
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
											<mask id="mask0_204_148" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
												<rect width="24" height="24" fill="white"/>
											</mask>
											<g mask="url(#mask0_204_148)">
												<path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
												<path d="M6 21V19C6 17.9391 6.42143 16.9217 7.17157 16.1716C7.92172 15.4214 8.93913 15 10 15H14C15.0609 15 16.0783 15.4214 16.8284 16.1716C17.5786 16.9217 18 17.9391 18 19V21" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
											</g>
										</svg>
									</span>
									<input type="text" id="username" placeholder="usuario" class="profile-custom-input">
								</div>
								<div class="form-details-sign-in margin-top">
									<span>
										<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
											<mask id="mask0_330_7186" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
												<rect width="24" height="24" fill="white"/>
											</mask>
											<g mask="url(#mask0_330_7186)">
												<path d="M19 5H5C3.89543 5 3 5.89543 3 7V17C3 18.1046 3.89543 19 5 19H19C20.1046 19 21 18.1046 21 17V7C21 5.89543 20.1046 5 19 5Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
												<path d="M3 7L12 13L21 7" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
											</g>
										</svg>
									</span>
									<input type="email" id="email" placeholder="correo" class="profile-custom-input" >
								</div>
								<div class="form-details-sign-in margin-top">
									<span>
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
											<mask id="mask0_204_148" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
												<rect width="24" height="24" fill="white"/>
											</mask>
											<g mask="url(#mask0_204_148)">
												<path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
												<path d="M6 21V19C6 17.9391 6.42143 16.9217 7.17157 16.1716C7.92172 15.4214 8.93913 15 10 15H14C15.0609 15 16.0783 15.4214 16.8284 16.1716C17.5786 16.9217 18 17.9391 18 19V21" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
											</g>
										</svg>
									</span>
									<input type="text" id="name" placeholder="nombre" class="profile-custom-input">
								</div>
								<div class="form-details-sign-in margin-top">
									<span>
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
											<mask id="mask0_204_148" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
												<rect width="24" height="24" fill="white"/>
											</mask>
											<g mask="url(#mask0_204_148)">
												<path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
												<path d="M6 21V19C6 17.9391 6.42143 16.9217 7.17157 16.1716C7.92172 15.4214 8.93913 15 10 15H14C15.0609 15 16.0783 15.4214 16.8284 16.1716C17.5786 16.9217 18 17.9391 18 19V21" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
											</g>
										</svg>
									</span>
									<input type="password" id="password" placeholder="contraseña" class="profile-custom-input">
								</div>
							</form>
						</div>
					</div>
				</div>
				<div class="save-changes-btn mt-32">
					<button type="button" class="btn btn-primary" onclick="saveChanges()">Guardar cambios</button>
				</div>
			</div>
		<!-- Profile edit  screen end -->
	</div>
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/slick.min.js"></script>
	<script src="assets/js/bootstrap.bundle.min.js"></script>
	<script src="assets/js/intlTelInput-jquery.min.js"></script>
	<script src="assets/js/country-flag.js"></script>
	<script src="assets/js/custom.js"></script>
	<script>
   document.addEventListener('DOMContentLoaded', function () {
    loadUserData();
});



async function loadUserData() {
    try {
        const response = await fetch('php/get_user.php', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'same-origin',
        });
        const data = await response.json();

        document.getElementById('username').value = data.username;
        document.getElementById('email').value = data.email;
        document.getElementById('name').value = data.nombre;
        document.getElementById('password').value = data.pass;
             document.getElementById("profileImage").src = data.photo
       
		
		if (data.photo) {
            document.getElementById('profileImage').src = data.photo;
        } else {
            document.getElementById('profileImage').src = 'https://i.ibb.co/KK64x5S/default-avatar-icon-of-social-media-user-vector.jpg';
        }
    } catch (error) {
        console.error('Error loading user data:', error);
    }
}

// Función para previsualizar la imagen
document.getElementById('imageInput').addEventListener('change', function (event) {
    const file = event.target.files[0];
    if (file) {
        if (file.size > 12000000) { // Validar tamaño (2MB)
            alert('La imagen es demasiado grande. El tamaño máximo es 2MB.');
            this.value = ''; // Limpiar input
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function (e) {
            document.getElementById('profileImage').src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
});

// Función para validar email
function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

// Función principal para guardar cambios
async function saveChanges() {
    try {
        // Obtener valores
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const name = document.getElementById('name').value.trim();
        const password = document.getElementById('password').value;
        
        // Validaciones
        if (!username || !email || !name) {
            alert('Por favor, complete todos los campos obligatorios');
            return;
        }

        if (!isValidEmail(email)) {
            alert('Por favor, ingrese un email válido');
            return;
        }

        // Preparar FormData para envío
        const formData = new FormData();
        formData.append('username', username);
        formData.append('email', email);
        formData.append('name', name);
        
        if (password) {
            formData.append('password', password);
        }

        // Manejar la imagen si existe
        const fileInput = document.getElementById('imageInput');
        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            
            // Subir a ImgBB
            const imgbbFormData = new FormData();
            imgbbFormData.append('image', file);

            const imgbbResponse = await fetch('https://api.imgbb.com/1/upload?key=f03200f4cc8cbfbc0d1c8f00fac290fc', {
                method: 'POST',
                body: imgbbFormData
            });

            if (!imgbbResponse.ok) {
                throw new Error('Error al subir la imagen');
            }

            const imgbbData = await imgbbResponse.json();
            if (imgbbData.data && imgbbData.data.url) {
                formData.append('profileImageURL', imgbbData.data.url);
            }
        }

        // Enviar datos al servidor
        const response = await fetch('php/update_user.php', {
            method: 'POST',
            body: formData,
          
        });

        if (!response.ok) {
            throw new Error('Error en la respuesta del servidor');
        }

        const data = await response.json();
        
        if (data.message) {
            alert(data.message);
            // Recargar la página o actualizar la interfaz según necesites
            location.reload();
        }

    } catch (error) {
        console.error('Error:', error);
        alert('Ha ocurrido un error: ' + error.message);
    }
}

// Agregar el evento al formulario
document.getElementById('updateForm').addEventListener('submit', function(e) {
    e.preventDefault();
    saveChanges();
});

    </script>

</body>
</html>